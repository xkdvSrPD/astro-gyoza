<!-- 代码复制功能处理器 -->
<script>
  function copyCodeToClipboard(code: string, lang: string) {
    navigator.clipboard.writeText(code).then(() => {
      // 显示复制成功提示
      // showToast(`${lang} 代码已复制到剪贴板`)
    }).catch(() => {
      // 降级方案：使用传统方法复制
      const textArea = document.createElement('textarea')
      textArea.value = code
      document.body.appendChild(textArea)
      textArea.select()
      document.execCommand('copy')
      document.body.removeChild(textArea)
      
      // showToast(`${lang} 代码已复制到剪贴板`)
    })
  }

  // function showToast(message: string) {
  //   // 通过全局事件触发toast
  //   const event = new CustomEvent('code-copy-success', {
  //     detail: { message }
  //   })
  //   window.dispatchEvent(event)
  // }

  function handleCopyClick(event: Event) {
    const target = event.target as HTMLElement
    if (!target.classList.contains('copy-code-btn')) return
    
    event.preventDefault()
    
    // 获取语言信息
    const lang = target.getAttribute('data-lang') || 'code'
    
    // 找到对应的代码块
    const codeBlock = target.parentElement?.querySelector('pre code')
    if (!codeBlock) return
    
    // 获取代码内容（去除语法高亮的HTML标签）
    const code = codeBlock.textContent || ''
    
    // 复制到剪贴板
    copyCodeToClipboard(code, lang)
    
    // 添加视觉反馈
    const originalText = target.textContent
    target.textContent = '已复制!'
    target.style.backgroundColor = 'rgb(34 197 94)' // green-500
    target.style.color = 'white'
    
    setTimeout(() => {
      target.textContent = originalText
      target.style.backgroundColor = ''
      target.style.color = ''
    }, 1500)
  }

  // 监听点击事件
  document.addEventListener('click', handleCopyClick)
  
  // 监听路由切换事件，重新绑定事件
  document.addEventListener('swup:content:replace', () => {
    // swup会替换内容，需要重新绑定事件监听器
    document.addEventListener('click', handleCopyClick)
  })
</script>